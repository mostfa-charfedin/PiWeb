{% extends 'navBar.html.twig' %}

{% block title %}Ressources{% endblock %}

{% block content %}
<main id="main" class="main">
  <div class="pagetitle d-flex justify-content-between align-items-center">
    <div>
      <h1>Ressources</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active">Ressources</li>
        </ol>
      </nav>
    </div>
    <div>
      <a href="{{ path('app_user_ressources_new') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i> Add New Resource
      </a>
    </div>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-12">
        <!-- Flash Messages -->
        {% for label, messages in app.flashes %}
          {% for message in messages %}
            <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
              {% if label == 'success' %}
                <i class="bi bi-check-circle me-1"></i>
              {% elseif label == 'error' %}
                <i class="bi bi-exclamation-octagon me-1"></i>
              {% endif %}
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endfor %}

        <!-- Search and Filter Form -->
        <div class="card shadow-sm rounded mb-4">
          <div class="card-body">
            <form id="filterForm" class="row g-3">
              <div class="col-md-4">
                <input type="text" name="searchTitle" class="form-control" placeholder="Search by title..." value="{{ app.request.query.get('searchTitle') }}">
              </div>
              <div class="col-md-3">
                <select name="type" class="form-select">
                  <option value="">All Types</option>
                  <option value="Document" {% if app.request.query.get('type') == 'Document' %}selected{% endif %}>Document</option>
                  <option value="Video" {% if app.request.query.get('type') == 'Video' %}selected{% endif %}>Video</option>
                  <option value="Link" {% if app.request.query.get('type') == 'Link' %}selected{% endif %}>Link</option>
                  <option value="Other" {% if app.request.query.get('type') == 'Other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="col-md-3">
                <select name="sort" class="form-select">
                  <option value="newest" {% if app.request.query.get('sort') == 'newest' %}selected{% endif %}>Newest First</option>
                  <option value="oldest" {% if app.request.query.get('sort') == 'oldest' %}selected{% endif %}>Oldest First</option>
                  <option value="title" {% if app.request.query.get('sort') == 'title' %}selected{% endif %}>Title A-Z</option>
                  <option value="rating" {% if app.request.query.get('sort') == 'rating' %}selected{% endif %}>Highest Rated</option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                  <i class="bi bi-search me-1"></i> Search
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Resources Grid -->
        <div class="row g-4">
          {% for ressource in ressources %}
            <div class="col-md-6 col-lg-4">
              <div class="card resource-card h-100 {% if ressource.type == 'Document' %}document-card{% elseif ressource.type == 'Video' %}video-card{% elseif ressource.type == 'Link' %}link-card{% else %}other-card{% endif %}">
                <div class="card-body">
                  <div class="resource-icon mb-3">
                    {% if ressource.type == 'Document' %}
                      <i class="bi bi-journal-text document-icon"></i>
                    {% elseif ressource.type == 'Video' %}
                      <i class="bi bi-play-circle video-icon"></i>
                    {% elseif ressource.type == 'Link' %}
                      <i class="bi bi-globe link-icon"></i>
                    {% else %}
                      <i class="bi bi-collection other-icon"></i>
                    {% endif %}
                  </div>
                  <h5 class="card-title">{{ ressource.titre }}</h5>
                  <p class="card-text text-muted">{{ ressource.description|length > 100 ? ressource.description|slice(0, 100) ~ '...' : ressource.description }}</p>
                  <div class="resource-meta d-flex justify-content-between align-items-center mt-3">
                    <span class="badge {% if ressource.type == 'Document' %}bg-primary{% elseif ressource.type == 'Video' %}bg-danger{% elseif ressource.type == 'Link' %}bg-success{% else %}bg-secondary{% endif %}">{{ ressource.type }}</span>
                    <div class="rating">
                      <i class="bi bi-star-fill text-warning"></i>
                      <span>{{ ressource.noteaverage|number_format(1) }}</span>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                  <div class="d-flex gap-2">
                    <a href="{{ path('app_user_ressources_show', {'idresource': ressource.idresource}) }}" class="btn btn-outline-primary flex-grow-1">
                      <i class="bi bi-eye me-1"></i> View Details
                    </a>
                    {% if app.user and app.user.id == ressource.id.id %}
                      <form method="post" action="{{ path('app_ressources_delete', {'idresource': ressource.idresource}) }}" onsubmit="return confirm('Are you sure you want to delete this resource?');" style="display: inline;">
                        <input type="hidden" name="_method" value="DELETE">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ ressource.idresource) }}">
                        <button class="btn btn-outline-danger">
                          <i class="bi bi-trash"></i>
                        </button>
                      </form>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <div class="col-12">
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-1"></i> No resources found.
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if pagination.totalPages > 1 %}
          <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Page navigation">
              <ul class="pagination">
                {% if pagination.currentPage > 1 %}
                  <li class="page-item">
                    <a class="page-link" href="{{ path('app_user_ressources_index', {
                      'page': pagination.currentPage - 1,
                      'searchTitle': app.request.query.get('searchTitle'),
                      'type': app.request.query.get('type'),
                      'sort': app.request.query.get('sort')
                    }) }}" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                {% endif %}
                
                {% for i in 1..pagination.totalPages %}
                  <li class="page-item {% if i == pagination.currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path('app_user_ressources_index', {
                      'page': i,
                      'searchTitle': app.request.query.get('searchTitle'),
                      'type': app.request.query.get('type'),
                      'sort': app.request.query.get('sort')
                    }) }}">{{ i }}</a>
                  </li>
                {% endfor %}
                
                {% if pagination.currentPage < pagination.totalPages %}
                  <li class="page-item">
                    <a class="page-link" href="{{ path('app_user_ressources_index', {
                      'page': pagination.currentPage + 1,
                      'searchTitle': app.request.query.get('searchTitle'),
                      'type': app.request.query.get('type'),
                      'sort': app.request.query.get('sort')
                    }) }}" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                  </li>
                {% endif %}
              </ul>
            </nav>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}

{% block stylesheets %}
<style>
  .resource-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 1rem;
    overflow: hidden;
    border: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .resource-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }

  /* Document Card Styles */
  .document-card {
    border-top: 4px solid #0d6efd;
  }
  .document-icon {
    color: #0d6efd;
    font-size: 3rem;
  }

  /* Video Card Styles */
  .video-card {
    border-top: 4px solid #dc3545;
  }
  .video-icon {
    color: #dc3545;
    font-size: 3rem;
  }

  /* Link Card Styles */
  .link-card {
    border-top: 4px solid #198754;
  }
  .link-icon {
    color: #198754;
    font-size: 3rem;
  }

  /* Other Card Styles */
  .other-card {
    border-top: 4px solid #6c757d;
  }
  .other-icon {
    color: #6c757d;
    font-size: 3rem;
  }

  .resource-icon {
    text-align: center;
    margin-bottom: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 60px;
  }

  .card-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
  }

  .card-text {
    font-size: 0.9rem;
    color: var(--text-light);
  }

  .resource-meta {
    font-size: 0.85rem;
  }

  .rating {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .pagination .page-link {
    color: var(--primary-color);
    border: none;
    margin: 0 0.25rem;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
  }

  .pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    color: white;
  }

  .pagination .page-link:hover {
    background-color: var(--primary-hover);
    color: white;
  }
</style>
{% endblock %} 