{% extends 'navBar.html.twig' %}

{% block title %}Available Quizzes{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    .quiz-card {
      border-radius: 1rem;
      transition: transform 0.2s ease;
    }
    .quiz-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .quiz-title {
      font-weight: 600;
      color: #2c3e50;
    }
    .btn-take-quiz {
      background-color: #3498db;
      color: #fff;
      font-weight: 500;
      border-radius: 0.5rem;
    }
    .btn-take-quiz:hover {
      background-color: #2980b9;
    }
    .badge-passed {
      background-color: #6c757d;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    .badge-score {
      background-color: #2ecc71;
      font-size: 0.8rem;
      margin-top: 0.3rem;
    }
    .progress {
      height: 10px;
      margin-top: 0.5rem;
      border-radius: 5px;
    }
    .progress-bar {
      background-color: #2ecc71;
    }
  </style>
{% endblock %}

{% block content %}
<main id="main" class="main">
  <div class="pagetitle">
    <h1>Available Quizzes</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Home</a></li>
        <li class="breadcrumb-item active">Quizzes</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="row">
      {% for quiz in quizzes %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card quiz-card h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="quiz-title">{{ quiz.nom }}</h5>

              {% if quizResults is defined and quiz.idquiz in quizResults %}
                {% set result = quizResults[quiz.idquiz] %}
                <span class="badge badge-passed">Already Passed</span>
                <span class="badge badge-score">Score: {{ result.score }}/{{ result.total }}</span>

                <div class="progress" role="progressbar" aria-valuenow="{{ result.score }}" aria-valuemin="0" aria-valuemax="{{ result.total }}">
                  <div class="progress-bar" style="width: {{ (result.score / result.total * 100)|round(0, 'floor') }}%"></div>
                </div>
              {% endif %}

              <div class="mt-auto">
                {% if quizResults is not defined or quiz.idquiz not in quizResults %}
                  <a href="{{ path('user_quiz_start', {'id': quiz.idquiz}) }}" class="btn btn-take-quiz w-100 mt-3">
                    <i class="bi bi-play-circle-fill"></i> Take Quiz
                  </a>
                {% else %}
                  <button class="btn btn-secondary w-100 mt-3" disabled>
                    <i class="bi bi-check-circle-fill"></i> Quiz Completed
                  </button>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div class="col-12">
          <div class="alert alert-info text-center">
            No quizzes available at the moment.
          </div>
        </div>
      {% endfor %}
    </div>
  </section>
</main>
{% endblock %}
