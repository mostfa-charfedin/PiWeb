{% extends 'navBar.html.twig' %}

{% block title %}Available Quizzes{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    .quiz-card {
      border-radius: 1rem;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .quiz-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.15);
    }

    .quiz-title {
      font-weight: 600;
      font-size: 1.2rem;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .btn-take-quiz {
      background-color: #3498db;
      color: #fff;
      font-weight: 500;
      border-radius: 0.5rem;
    }

    .btn-take-quiz:hover {
      background-color: #2980b9;
    }

    .badge-passed {
      background-color: #db3498;
      font-size: 0.75rem;
      padding: 0.3rem 0.6rem;
      border-radius: 0.5rem;
      margin-top: 0.5rem;
    }

    .badge-score {
      background-color: #db3498;
      font-size: 0.75rem;
      padding: 0.3rem 0.6rem;
      border-radius: 0.5rem;
      margin-top: 0.3rem;
      display: inline-block;
    }

    .quiz-status {
      margin-top: auto;
    }

    #quizSearch {
      min-width: 100px;
    }
  </style>
{% endblock %}

{% block content %}
<main id="main" class="main">
  <div class="pagetitle">
    <h1>Available Quizzes</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Home</a></li>
        <li class="breadcrumb-item active">Quizzes</li>
      </ol>
    </nav>
  </div>

  <!-- ðŸ” Search Bar Aligned Right -->
  <div class="d-flex justify-content-end mb-4">
    <div class="col-md-3">
      <input type="text" class="form-control form-control-sm" id="quizSearch" onkeyup="filterQuizzes()" placeholder="Search quiz by name...">
    </div>
  </div>

  <section class="section">
    <div class="row" id="quizContainer">
      {% if quizzes is not empty %}
        {% for quiz in quizzes %}
          <div class="col-md-6 col-lg-4 mb-4 quiz-box">
            <div class="card quiz-card h-100">
              <div class="card-body d-flex flex-column">
                <h5 class="quiz-title">{{ quiz.nom }}</h5>

                {% if quizResults[quiz.idquiz] is defined %}
                  {% set result = quizResults[quiz.idquiz] %}
                  <span class="badge badge-passed">Already Passed</span>
                  <span class="badge badge-score">Score: {{ result.score }}/{{ result.total }}</span>
                
                {% endif %}

                <div class="quiz-status mt-auto">
                  {% if quizResults[quiz.idquiz] is not defined %}
                    <a href="{{ path('user_quiz_start', {'id': quiz.idquiz}) }}" class="btn btn-take-quiz w-100 mt-3">
                      <i class="bi bi-play-circle-fill"></i> Take Quiz
                    </a>
                  {% else %}
                    <button class="btn btn-secondary w-100 mt-3" disabled>
                      <i class="bi bi-check-circle-fill"></i> Quiz Completed
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="alert alert-info text-center">
            No quizzes available at the moment.
          </div>
        </div>
      {% endif %}
    </div>
  </section>
</main>

<script>
  function filterQuizzes() {
    const input = document.getElementById("quizSearch");
    const filter = input.value.toLowerCase();
    const quizzes = document.querySelectorAll("#quizContainer .quiz-box");

    quizzes.forEach((quizBox) => {
      const title = quizBox.querySelector(".quiz-title").textContent.toLowerCase();
      quizBox.style.display = title.includes(filter) ? "block" : "none";
    });
  }
</script>
{% endblock %}
