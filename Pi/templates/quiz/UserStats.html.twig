{% extends 'navBar.html.twig' %}

{% block title %}My Quiz Statistics{% endblock %}

{% block content %}
<main id="main" class="main">
  <div class="pagetitle">
    <h1>My Quiz Progress</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Home</a></li>
        <li class="breadcrumb-item active">My Stats</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">

        <div class="card">
          <div class="card-body">
            <h5 class="card-title">My Quizzes</h5>

            {% if scores is not empty %}
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Quiz</th>
                    <th scope="col">My Score</th>
                    <th scope="col">Chart</th>
                  </tr>
                </thead>
                <tbody>
                  {% for score in scores %}
                    <tr>
                      <td>{{ score.quiz.nom }}</td>
                      <td>{{ score.score }} / {{ score.total }}</td>
                      <td>
                        <canvas id="user-chart-{{ score.id }}" width="100" height="100"></canvas>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <div class="alert alert-info text-center">
                You haven't completed any quizzes yet.
              </div>
            {% endif %}

          </div>
        </div>

      </div>
    </div>
  </section>

</main>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    {% for score in scores %}
      var ctxUser{{ score.id }} = document.getElementById('user-chart-{{ score.id }}').getContext('2d');
      new Chart(ctxUser{{ score.id }}, {
          type: 'doughnut',
          data: {
              labels: ['Correct', 'Wrong'],
              datasets: [{
                  data: [{{ score.score }}, {{ score.total - score.score }}],
                  backgroundColor: ['#36A2EB', '#FF6384'],
              }]
          },
          options: {
              responsive: true,
              plugins: {
                  legend: {
                      position: 'bottom'
                  }
              }
          }
      });
    {% endfor %}
});
</script>

{% endblock %}