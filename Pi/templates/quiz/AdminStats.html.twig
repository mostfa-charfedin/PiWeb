{% extends 'navBar.html.twig' %}

{% block title %}Quiz Global Statistics{% endblock %}

{% block content %}
<main id="main" class="main">
  <div class="pagetitle">
    <h1>Global Quiz Statistics</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Home</a></li>
        <li class="breadcrumb-item active">Admin Stats</li>
      </ol>
    </nav>
  </div>

  <section class="section">
    <div class="row">
      <div class="col-lg-12">

        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Overview by Quiz</h5>

            {% if quizzes is not empty %}
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col">Quiz Name</th>
                    <th scope="col">Attempts</th>
                    <th scope="col">Avg. Score</th>
                    <th scope="col">Passes</th>
                    <th scope="col">Fails</th>
                    <th scope="col">Chart</th>
                  </tr>
                </thead>
                <tbody>
                  {% for quizStat in quizzes %}
                    <tr>
                      <td>{{ quizStat.quiz.nom }}</td>
                      <td>{{ quizStat.totalAttempts }}</td>
                      <td>
                        {% if quizStat.totalAttempts > 0 %}
                          {{ (quizStat.totalScore / quizStat.totalAttempts)|number_format(2) }}
                        {% else %}
                          0
                        {% endif %}
                      </td>
                      <td>{{ quizStat.passes }}</td>
                      <td>{{ quizStat.fails }}</td>
                      <td>
                        <canvas id="chart-{{ quizStat.quiz.id }}" width="100" height="100"></canvas>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <div class="alert alert-warning text-center">
                No quiz statistics available yet.
              </div>
            {% endif %}

          </div>
        </div>

      </div>
    </div>
  </section>

</main>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    {% for quizStat in quizzes %}
      var ctx{{ quizStat.quiz.id }} = document.getElementById('chart-{{ quizStat.quiz.id }}').getContext('2d');
      new Chart(ctx{{ quizStat.quiz.id }}, {
          type: 'pie',
          data: {
              labels: ['Pass', 'Fail'],
              datasets: [{
                  data: [{{ quizStat.passes }}, {{ quizStat.fails }}],
                  backgroundColor: ['#4CAF50', '#F44336'],
              }]
          },
          options: {
              responsive: true,
              plugins: {
                  legend: {
                      position: 'bottom'
                  }
              }
          }
      });
    {% endfor %}
});
</script>

{% endblock %}